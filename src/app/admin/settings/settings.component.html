<div class="admin-page-container">
  <h3 class="white-text" style="margin-bottom: 50px;">Tiimien tulokset</h3>
  
  <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; width: 100%;">
    <input style="width: clamp(200px, 40%, 400px);" type="text" placeholder="Hae tiimiä..." [(ngModel)]="searchTerm" (input)="applyFilter()">
    <select style="width: clamp(200px, 40%, 400px); height: clamp(43px, 6vh, 53px); border-radius: 8px; font-family: Karla; font-size: 20px; padding: 0 10px;" [(ngModel)]="selectedRegion" (change)="applyFilter()">
      <option value="">Kaikki alueet</option>
      <option *ngFor="let region of regions" [value]="region.regionCode">{{region.regionCode}}</option>
    </select>
  </div>

  <h3 *ngIf="noActiveEvent">Ei aktiivista tapahtumaa</h3>
  <div *ngIf="teams;else loading">
    <div *ngIf="teams && teams.length == 0">
      <h3 class="white-text" style="text-align: center;">Ei tiimejä..</h3>
    </div>
    <div class="page-list custom-scroll" *ngIf="teams && teams.length > 0">
      <app-expanded-bar-card *ngFor="let team of teams" [team]="team" (edit)="openEditModal($event)"></app-expanded-bar-card>
    </div>
  </div>
</div>

<div class="overlay-mask" [style]="{'display': editModalOpen ? 'block':'none'}" (click)="closeModal()"></div>
<div class="overlay-window" [class.overlay-hidden]="!editModalOpen">
  <div style="max-width: 90vw; display: flex; flex-direction: column; align-items: center; gap: 20px;" *ngIf="teamToEdit">
    <h3 style="color: black;">Muokkaa tiimiä</h3>
    
    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
      <div style="text-align: center;">
        <p style="color: black;">Nimi</p>
        <input type="text" [(ngModel)]="teamToEdit.name">
      </div>
      <div style="text-align: center;">
        <p style="color: black;">Login ID</p>
        <input style="border: none; background: var(--admin-white-accent); box-shadow: inset 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 8px; height: clamp(43px, 6vh, 53px); color: var(--admin-dark-accent); font-family: Karla; font-size: clamp(20px, 2vw, 30px); padding: 0px 10px;" type="number" [(ngModel)]="teamToEdit.loginId">
      </div>
    </div>

    <div style="text-align: center; width: 100%; margin-top: 10px;">
        <p style="color: black;">Kommentti</p>
        <textarea style="width: 80%; border: none; background: var(--admin-white-accent); box-shadow: inset 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 8px; color: var(--admin-dark-accent); font-family: Karla; font-size: 16px; padding: 10px;" rows="3" [(ngModel)]="teamToEdit.internalComment"></textarea>
    </div>

    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; align-items: center; margin-top: 10px;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <p style="color: black; margin: 0;">Fukseja?</p>
            <label class="switch">
                <input type="checkbox" [(ngModel)]="teamToEdit.fuksiStatus">
                <span class="slider round"></span>
            </label>
        </div>
    </div>

    <div style="width: 80%; max-height: 300px; overflow-y: auto; margin: 10px 0; padding: 0 10px;">
      <h4 style="color: black; text-align: center;">Pisteet</h4>
      <div *ngFor="let bar of teamToEdit.bars" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <p style="color: black; margin: 0; width: 60%; font-size: 16px;">{{bar.name}}</p>
        <input style="width: 80px; border: none; background: var(--admin-white-accent); box-shadow: inset 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 8px; height: 35px; color: var(--admin-dark-accent); font-family: Karla; font-size: 18px; padding: 0 5px; text-align: center;" type="number" [(ngModel)]="bar.score">
      </div>
      <div *ngIf="teamToEdit.bonusBar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <p style="color: black; margin: 0; width: 60%; font-size: 16px;">Bonus: {{teamToEdit.bonusBar.name}}</p>
        <input style="width: 80px; border: none; background: var(--admin-white-accent); box-shadow: inset 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 8px; height: 35px; color: var(--admin-dark-accent); font-family: Karla; font-size: 18px; padding: 0 5px; text-align: center;" type="number" [(ngModel)]="teamToEdit.bonusBar.score">
        <button class="button-fixed-width red-button" style="width: auto; padding: 5px 10px; margin-left: 5px; height: 35px; font-size: 14px;" (click)="deleteBonusBar()">Poista</button>
      </div>
    </div>

    <div style="display: flex; gap: 15px;">
      <button class="button-fixed-width green-button" (click)="saveTeam()">Tallenna</button>
      <button class="button-fixed-width red-button" (click)="deleteTeam()">Poista</button>
      <button class="button-fixed-width dark-button" (click)="closeModal()">Peruuta</button>
    </div>
  </div>
</div>

<ng-template #loading>
  <loading-with-size [size]="200"></loading-with-size>
</ng-template>
